---
name: "Jenna A. P."
surname: "Hamlin"
position: "Health Scientist - Informatics"
email: "jennahamlin@gmail.com"
github: jennahamlin
aboutme: "I am a scientist with over 10 years of experience in bioinformatics, genomics, and classical genetics. My training includes a broad set of skills and approaches including programming and experimental design to evolutionary biology and species distribution modeling. Currently, I work at the intersection of public health (ph), ph computational tool development, and the study of pathogens, with a focus on reproducible research."
date: "`r format(Sys.time(), '%B %Y')`"
headcolor: 414141

output: vitae::awesomecv
latex_engine: xelatex

header-includes:
  - \usepackage{geometry}
  - \newgeometry{left=1cm, right=1.5cm, top=1.0cm, bottom=1.0cm, footskip=0.5cm}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(vitae)
library(here)
library(magrittr)
library(glue)
library(readr)
library(dplyr)
library(stringr)
library(scholar)
```

```{r get data, include=FALSE}

# ---- Load data ----
edu  <- readr::read_csv(here("data", "education.csv"))
work <- readr::read_csv(here("data", "appointments.csv"))

skills <- readr::read_csv(here("data", "skillsUpdated.csv")) %>%
  group_by(category) %>%
  summarise(skill = paste(skill, collapse = ", "), .groups = "drop")

packages <- readr::read_csv(here("data", "packages.csv"))

# ---- Helper functions ----

shorten_journal_names <- function(journal_names) {
  if (!requireNamespace("journalabbr", quietly = TRUE)) {
    stop("Please install the 'journalabbr' package: install.packages('journalabbr')")
  }

  abbr_df <- journalabbr:::abbrtable_sys %>%
    select(journal_lower, journal_abbr) %>%
    mutate(journal_lower = tolower(journal_lower))

  input_df <- tibble(journal_original = journal_names) %>%
    mutate(journal_lower = tolower(journal_original))

  joined <- left_join(input_df, abbr_df, by = "journal_lower")

  if_else(is.na(joined$journal_abbr), joined$journal_original, joined$journal_abbr)
}

shorten_title <- function(titles, max_width = 100) {
  # Apply the shortening logic element-wise to each title
  vapply(titles, function(title) {
    title <- trimws(title)
    
    # If it's already short enough, return it
    if (nchar(title) <= max_width) return(title)
    
    # Split into words
    words <- strsplit(title, "\\s+")[[1]]
    shortened <- c()
    total_len <- 0
    for (w in words) {
      if ((total_len + nchar(w) + 1) > max_width) break
      shortened <- c(shortened, w)
      total_len <- total_len + nchar(w) + 1
    }
    paste(paste(shortened, collapse = " "), "â€¦")
  }, character(1))
}

# ---- Publications ----

pubs <- scholar::get_publications("OIIf5T4AAAAJ&hl") %>%
  mutate(
    author       = str_trim(as.character(author)),
    first_author = str_starts(author, "JAP Hamlin"),
    preprint     = journal %in% c("bioRxiv", "BioRxiv")
  ) %>%
  filter(!journal %in% c("University of Georgia", "Bulletin of the Ecological Society of America")) %>%
  arrange(desc(year)) %>%
  mutate(journal_short = shorten_journal_names(journal)) %>%
  mutate(
    journal_short = recode(journal_short,
      "G" = "G3",
      "Rapidly evolving genes and genetic systems" = "Rapidly Evol. Genes Genet. Syst."
    ),
    title_short = shorten_title(title, max_width = 100)   
  )


# Manual corrections
pubs$journal_short[str_detect(pubs$journal_short, "Reticulate Evolution")] <- "Reticulate Evolution"
pubs$journal_short[str_detect(pubs$journal_short, "MMWR Morb Mortal Wkly Rep")] <- "MMWR"

```

# Education

```{r education}
vitae::detailed_entries(edu, 
                 when = awarded,
                 what = degree,
                 where = loc,
                 with = uni)
```

# Work Experience

```{r work}
work %>% 
  vitae::detailed_entries(
    what = role,
    when = glue("{start_date}--{end_date}"),
    with = company,
    where = where,
    why = details)

```

# Skills

```{r skills}
skills %>% 
  vitae::detailed_entries(what = skill, with = category)
```

# Publications

```{r publications}
pubs %>%
  filter(!preprint) %>%
  vitae::detailed_entries(
    what = title_short,
    when = year,
    with = author,
    where = journal_short,
    .protect = TRUE
  )
```

# Packages

```{r packages}

packages %>% 
  vitae::detailed_entries(
    what = role,
    when = year,
    with = title,
     where = location,
    .protect = TRUE)
```
